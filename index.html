<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NurturCover - Home</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <nav>
            <h1 class="logo">NurturCover</h1>
            <ul class="menu">
                <li><a href="Plans.html">Plans</a></li>
                <li><a href="Benefits.html">Benefits</a></li>
                <li><a href="MissionVision.html">Mission & Vision</a></li>
                <li><a href="#" id="openLogin">Login</a></li>
                <li><a href="#" id="openRegister">Register</a></li>
            </ul>

            <!-- Profile icon (hidden by default) -->
            <a href="profile.html" id="profileIcon" style="display:none;">
                <img src="images/profileicon.png" alt="Profile" style="width:40px; height:40px; border-radius:50%;">
            </a>
        </nav>
    </header>

    <main class="hero">
        <!-- Responsive Logo -->
        <picture>
            <source src="images/NurturCover_mobile.png" media="(max-width: 600px)">
            <source src="images/NurturCover_desktop.png" media="(min-width: 601px)">
            <img src="images/Screenshot 2025-09-16 134104.png" alt="NurturCover Logo">
        </picture>

        <div class="dots">
            <span class="dot active"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </main>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeLogin">&times;</span>
            <h2>Login</h2>
            <form id="loginForm"> <!-- ðŸ”´ add form id -->
                <input type="text" id="loginUsername" placeholder="Username" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <p id="loginMessage" style="color:red; text-align:center;"></p> <!-- ðŸ”´ feedback -->
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeRegister">&times;</span>
            <h2>Register</h2>
            <form id="registerForm">
                <input type="text" id="registerName" placeholder="Full Name" required>
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="text" id="registerUsername" placeholder="Username" required>
                <input type="password" id="registerPassword" placeholder="Password" required>

                <!-- POPI acceptance -->
                <div style="display: flex; align-items: center; margin: 15px 0; gap: 10px; font-size: 0.95em;">
                    <input type="checkbox" id="popiAccept" required style="width: 18px; height: 18px; cursor: pointer;">
                    <label for="popiAccept" style="cursor: pointer;">
                        I agree to the <a href="popi.html" target="_blank"
                            style="color: red; text-decoration: underline;">POPI Privacy Policy</a>
                    </label>
                </div>
                <button type="submit">Register</button>
            </form>
            <p id="registerMessage" style="color:red; text-align:center;"></p>
        </div>
    </div>
    
    <script>
        // Get elements
        const loginModal = document.getElementById("loginModal");
        const registerModal = document.getElementById("registerModal");

        const openLogin = document.getElementById("openLogin");
        const openRegister = document.getElementById("openRegister");

        const closeLogin = document.getElementById("closeLogin");
        const closeRegister = document.getElementById("closeRegister");

        const profileIcon = document.getElementById("profileIcon");

        // Open modals
        openLogin.onclick = () => loginModal.style.display = "block";
        openRegister.onclick = () => registerModal.style.display = "block";

        // Close modals
        closeLogin.onclick = () => loginModal.style.display = "none";
        closeRegister.onclick = () => registerModal.style.display = "none";

        // Close if clicking outside modal
        window.onclick = (event) => {
            if (event.target === loginModal) loginModal.style.display = "none";
            if (event.target === registerModal) registerModal.style.display = "none";
        };

        // ðŸ”´ Handle Login
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.getElementById("loginUsername").value;
            const password = document.getElementById("loginPassword").value;

            try {
                const res = await fetch("https://nurturcover.page.gd/api/login", { // ðŸ”´ API endpoint
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    document.getElementById("loginMessage").style.color = "green";
                    document.getElementById("loginMessage").textContent = "Login successful!";
                    profileIcon.style.display = "inline"; // ðŸ”´ show profile icon
                    loginModal.style.display = "none";    // ðŸ”´ close modal
                } else {
                    document.getElementById("loginMessage").textContent = data.error || "Login failed";
                }
            } catch (err) {
                document.getElementById("loginMessage").textContent = "Server error";
            }
        });

        // ðŸ”´ Handle Register
        document.getElementById("registerForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const name = document.getElementById("registerName").value;
            const email = document.getElementById("registerEmail").value;
            const username = document.getElementById("registerUsername").value;
            const password = document.getElementById("registerPassword").value;
            const popiAccepted = document.getElementById("popiAccept").checked;

            if (!popiAccepted) {
                document.getElementById("registerMessage").textContent = "You must accept the POPI Privacy Policy to register.";
                return;
            }

            try {
                const res = await fetch("https://nurturcover.page.gd/api/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, email, username, password })
                });

                const data = await res.json();
                if (res.ok) {
                    document.getElementById("registerMessage").style.color = "green";
                    document.getElementById("registerMessage").textContent = "Registration successful! You can login now.";
                    registerModal.style.display = "none";
                    loginModal.style.display = "block";
                } else {
                    document.getElementById("registerMessage").textContent = data.error || "Registration failed";
                }
            } catch (err) {
                document.getElementById("registerMessage").textContent = "Server error";
            }
        });
    </script>
    <footer>
        <li><a href="terms.html">Terms & Conditions</a></li>
        <li><a href="claims.html">Claims Process</a></li>
        <p>Â© 2025 NurturCover. All rights reserved.</p>
        </nav>
    </footer>
</body>

</html>